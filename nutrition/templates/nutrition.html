{% extends 'base.html' %}
{% load static %}
{% block title %}Nutrition{% endblock %}

{% block content %}
{% load tz %}
<link rel="stylesheet" href="{% static 'css/nutrition.css' %}?v={% now 'U' %}">

<div class="nutrition-page">

  <!-- Hero Section -->
  <section class="hero-banner">
    <img src="{% static 'img/nut4.avif' %}" alt="Healthy food banner">
    <div class="hero-overlay">
      <h1>Nutrition Dashboard</h1>
      <p>Fuel your progress ‚Äî track your meals, calories, and macros.</p>
    </div>
  </section>

  <!-- Daily Summary Cards -->
  <section class="nutrition-summary">
    <h2>Today's Nutrition Summary</h2>
    <div class="summary-grid">
      <div class="summary-card calories">
        <h3>Calories</h3>
        <p><strong>{{ totals.calories|default:0 }}</strong> / 2,100 kcal</p>
      </div>
      <div class="summary-card protein">
        <h3>Protein</h3>
        <p><strong>{{ totals.protein|default:0 }}</strong> g / 160g</p>
      </div>
      <div class="summary-card carbs">
        <h3>Carbs</h3>
        <p><strong>{{ totals.carbs|default:0 }}</strong> g / 250g</p>
      </div>
      <div class="summary-card fat">
        <h3>Fat</h3>
        <p><strong>{{ totals.fat|default:0 }}</strong> g / 70g</p>
      </div>
    </div>
  </section>

  <!-- Fancy Meal Logging Card -->
  <section class="meal-logger">
    <div class="meal-card">
      <h2>üç¥ Log a Meal</h2>
      <p class="subtitle">Quickly add your meals and track your daily intake.</p>
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="msg {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %}

      {% if form %}
      <form method="post" action="{% url 'nutrition:home' %}" class="meal-form">
        {% csrf_token %}

        <div class="form-grid">
          <div class="form-group">
            {{ form.meal_type.label_tag }}
            {{ form.meal_type }}
            {{ form.meal_type.errors }}
          </div>

          <div class="form-group">
            {{ form.food_name.label_tag }}
            {{ form.food_name }}
            {{ form.food_name.errors }}
          </div>

          <div class="form-group">
            {{ form.calories.label_tag }}
            {{ form.calories }}
            {{ form.calories.errors }}
          </div>

          <div class="form-group">
            {{ form.protein.label_tag }}
            {{ form.protein }}
            {{ form.protein.errors }}
          </div>

          <div class="form-group">
            {{ form.carbs.label_tag }}
            {{ form.carbs }}
            {{ form.carbs.errors }}
          </div>

          <div class="form-group">
            {{ form.fat.label_tag }}
            {{ form.fat }}
            {{ form.fat.errors }}
          </div>
        </div>

        <button type="submit" class="btn-log">+ Add Meal</button>
      </form>
      {% else %}
      <div class="login-cta" style="text-align:center;padding:18px;">
        <p style="color:#cfcfd6">Please <a href="{% url 'accounts:login' %}?next={{ request.path }}">log in</a> to add meals.</p>
      </div>
      {% endif %}
    </div>
  </section>

  

  <!-- Meal History Table -->
  <section class="meal-history">
    <h2>Today's Meals</h2>
    <table>
      <thead>
        <tr>
          <th>Meal</th>
          <th>Food</th>
          <th>Calories</th>
          <th>Protein</th>
          <th>Carbs</th>
          <th>Fat</th>
        </tr>
      </thead>
      <tbody>
        {% for meal in meals %}
        <tr>
          <td>{{ meal.meal_type }}</td>
          <td>{{ meal.food_name }}</td>
          <td>{{ meal.calories }}</td>
          <td>{{ meal.protein|default:0 }}g</td>
          <td>{{ meal.carbs|default:0 }}g</td>
          <td>{{ meal.fat|default:0 }}g</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="muted">No meals logged for today.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

</div>
{% endblock %}